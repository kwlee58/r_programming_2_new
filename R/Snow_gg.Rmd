---
title: "Snow_gg"
author: "coop711"
date: "2025-11-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = FALSE, message = FALSE}
# í•„ìš”í•œ íŒ¨í‚¤ì§€
library(HistData)
library(ggplot2)
library(dplyr)
library(showtext)

if (Sys.info()[["sysname"]] == "Windows") {
  win_home <- Sys.getenv("USERPROFILE")  # VMware Windowsì—ì„œë„ ì •ìƒ ë™ìž‘
  font_add(family = "kopub",
           regular = file.path(win_home, "AppData/Local/Microsoft/Windows/Fonts/KoPubWorld Dotum Medium.ttf"),
           bold    = file.path(win_home, "AppData/Local/Microsoft/Windows/Fonts/KoPubWorld Dotum Bold.ttf"))
} else {
  font_add(family = "kopub",
           regular = "~/Library/Fonts/KoPubWorld Dotum Medium.ttf",
           bold    = "~/Library/Fonts/KoPubWorld Dotum Bold.ttf")
}

showtext_auto()
```

## ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

```{r}
data(Snow.deaths)
data(Snow.pumps)
data(Snow.streets)
data(Snow.polygons)
```

## ðŸ”¹ 1ë‹¨ê³„: ë„ë¡œë§Œ ê·¸ë¦¬ê¸°

```{r, fig.width = 7, fig.height = 7}
g1 <- ggplot() +
  geom_path(data = Snow.streets,
            aes(x = x, y = y, group = street),
            color = "grey50", linewidth = 0.4) +
#  coord_fixed(xlim = c(3, 20), ylim = c(3, 20)) +
  labs(title = "1ë‹¨ê³„: Streets only") +
  theme_bw(base_family = "kopub") +
  theme(plot.title = element_text(hjust = 0.5))
g1
```

## ðŸ”¹ 2ë‹¨ê³„: ì‚¬ë§ìž ìœ„ì¹˜ ì¶”ê°€

```{r, fig.width = 7, fig.height = 7}
g2 <- g1 +
  geom_point(data = Snow.deaths,
             aes(x = x, y = y),
             color = "black", shape = 15, size = 1.2) +
  labs(title = "2ë‹¨ê³„: Add deaths")
g2
```

## ðŸ”¹ 3ë‹¨ê³„: íŽŒí”„ ìœ„ì¹˜ ë° ë¼ë²¨ ì¶”ê°€

```{r, fig.width = 7, fig.height = 7}
g3 <- g2 +
  geom_point(data = Snow.pumps,
             aes(x = x, y = y),
             color = "red", shape = 17, size = 3) +
  geom_text(data = Snow.pumps,
            aes(x = x, y = y, label = label),
            vjust = 1.3, size = 3) +
  labs(title = "3ë‹¨ê³„: Add pumps and labels")
g3
```

## ðŸ”¹ 4ë‹¨ê³„: ì§€ì—­ ê²½ê³„ì„ (polygons) ì¶”ê°€

```{r, fig.width = 7, fig.height = 7}
polygons_df <- bind_rows(lapply(seq_along(Snow.polygons), function(i) {
  data.frame(Snow.polygons[[i]], id = i)
}))
g4 <- g3 +
  geom_polygon(data = polygons_df,
               aes(x = x, y = y, group = id),
               fill = NA, color = "brown", linewidth = 0.6) +
  labs(title = "4ë‹¨ê³„: Add neighborhood boundaries")
g4
```

## ðŸ”¹ 5ë‹¨ê³„: ìŠ¤ì¼€ì¼ë°”(scale bar) ì¶”ê°€

```{r, fig.width = 7, fig.height = 7}
xs <- 3.5; ys <- 19.7
scale_df <- data.frame(x = xs + c(0, 4), y = ys + c(0, 0))
labels_df <- data.frame(
  x = xs + c(0, 2, 4, 4),
  y = ys + c(0, 0, 0, 0.1),
  label = c("0", "2", "4", "100 m.")
)
g5 <- g4 +
  annotate("segment",
           x = 4, xend = 8,
           y = 19.5, yend = 19.5,
           linewidth = 0.8) +
  annotate("text",
           x = c(4, 6, 8, 8),
           y = c(20.0, 20.0, 20.0, 20.5),
           label = c("0", "2", "4", "100 m."),
           size = 3) +
  labs(title = "5ë‹¨ê³„: Add scale bar")
g5
```

## ðŸ”¹ 6ë‹¨ê³„ (ì„ íƒ): ë°€ë„ ížˆíŠ¸ë§µ ì¶”ê°€

```{r, fig.width = 7, fig.height = 7}
# install.packages("KernSmooth")  # í•„ìš” ì‹œ
library(KernSmooth)
kde <- bkde2D(Snow.deaths[, c("x", "y")], bandwidth = c(0.5, 0.5))
dens_df <- expand.grid(x = kde$x1, y = kde$x2)
dens_df$z <- as.vector(kde$fhat)
clrs <- colorRampPalette(c(rgb(0, 1, 0, 0), rgb(1, 0, 0, 0.8)), alpha = TRUE)(20)

g6 <- g5 +
  geom_raster(data = dens_df,
              aes(x = x, y = y, fill = z),
              alpha = 0.5, interpolate = TRUE) +
  scale_fill_gradientn(colors = clrs, guide = "none") +
  labs(title = "6ë‹¨ê³„: Add density heatmap")
g6
```

## ðŸ”¹ ì¢…í•©: ë§ˆë¬´ë¦¬

```{r, fig.width = 7, fig.height = 7}
g7 <- g6 +
  coord_fixed(xlim = c(3, 20), ylim = c(3, 20)) +
  labs(
    title = "John Snowâ€™s Cholera Map (1854, Soho, London)",
    subtitle = "ì‚¬ë§ìž = ê²€ì€ ì‚¬ê°í˜• â–£   íŽŒí”„ = ë¹¨ê°„ ì‚¼ê°í˜• â–²",
    caption = "Source: John Snow (1855) _On the Mode of Communication of Cholera_"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 11, margin = margin(b = 10)),
    plot.caption = element_text(size = 8, hjust = 1, margin = margin(t = 10)),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    legend.position = "none",
    panel.grid = element_blank()
  )
g7
```

## Comments

John Snow ëŠ” ...

ì—¬ê¸°ì„œ í•™ìŠµí•œ R ì½”ë“œëŠ” ...